<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>embed: Time: Overflow aware: Clocks, Time Points and Durations</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">embed
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/d2b/time.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Time: Overflow aware: Clocks, Time Points and Durations</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Overview</h1>
<p>The <code>embed</code> library provides a fully overflow-aware timing system including:</p><ul>
<li>Clocks</li>
<li>Time points</li>
<li>Durations</li>
</ul>
<p>These types integrate seamlessly with the C++ <code>&lt;chrono&gt;</code> standard library while being specifically optimized for bare-metal embedded systems. They allow safe and precise tracking of time using wraparound counters (hardware timer-style), while preserving intuitive arithmetic and comparison operations.</p>
<hr  />
<h1><a class="anchor" id="overflow"></a>
Awareness of Overflow</h1>
<p>Unlike the standard <code>std::chrono</code> types which assume linear time, <code>embed</code>’s types are built on <code>ClockTick</code>, which wraps and tracks tick values modulo an overflow:</p>
<ul>
<li>Overflow handling is transparent.</li>
<li>All operations (e.g., <code>a &lt; b</code>, <code>b - a</code>) work correctly even when the counter has wrapped.</li>
<li>Tick differences and time comparisons are reliable as long as differences are <b>less than half the overflow window</b>.</li>
</ul>
<blockquote class="doxtable">
<p>This means the clock counter must count to <b>at least double</b> the maximum interval between two time points that are to be reliably compared. </p>
</blockquote>
<p>Note: The library is heavily optimised to avoid modulo operations and divisions. The fastest is to always use the full range of the integer datatype. If your hardware timer does not cover the full range, for example a 10 or 24-bit counter, then always make sure that the counter overflows on a power of 2 / the maximal value is 2^n-1. ⚠️ If arbitrary overflows are used, the library will use additional modulo operations, but only for constructions (can be mittigated by using <code>ClockTick::reinterpret</code>) and multiplication.</p>
<hr  />
<h1><a class="anchor" id="chrono"></a>
Integration with <code>&lt;chrono&gt;</code></h1>
<p><code><a class="el" href="../../da/d2e/namespaceembed.html#a0223e2bd607a0788b0c7955a65dfe73f" title="Overflow aware time duration type.">embed::Duration</a></code>, <code><a class="el" href="../../da/d2e/namespaceembed.html#af176ead949b706e7d5afcb8ddb67b543" title="Overflow aware time point.">embed::TimePoint</a></code>, and <code><a class="el" href="../../da/d86/structembed_1_1_clock.html" title="A template for an overflow aware clock type for the use with TimePoint">embed::Clock</a></code> all follow the exact semantics and layout of their standard counterparts:</p><ul>
<li><code><a class="el" href="../../da/d2e/namespaceembed.html#a0223e2bd607a0788b0c7955a65dfe73f" title="Overflow aware time duration type.">embed::Duration</a></code> is a wrapper around <code>std::chrono::duration</code> using <code>ClockTick</code> as its representation type.</li>
<li><code><a class="el" href="../../da/d2e/namespaceembed.html#af176ead949b706e7d5afcb8ddb67b543" title="Overflow aware time point.">embed::TimePoint</a></code> wraps <code>std::chrono::time_point</code> using your chosen <code>Clock</code>.</li>
<li>All durations can be converted using <code>std::chrono::duration_cast</code>.</li>
</ul>
<p>You can freely mix <code>embed</code> clocks with standard <code>std::chrono</code> durations where appropriate.</p>
<hr  />
<h1><a class="anchor" id="example"></a>
Example: Creating Your Own Clock</h1>
<p>Creating a custom hardware-aware overflow-safe clock is extremely simple. All you need to provide is:</p><ul>
<li>the <b>underlying integer type</b> of your timer register (e.g. <code>uint32_t</code>)</li>
<li>a <code>std::ratio</code> expressing its period relative to <code>1s</code> (e.g. <code>std::micro</code> if each tick represents a micro second)</li>
<li>a <code>constexpr</code> function that returns the current counter value</li>
<li><em>(optional)</em> the maximum value that the counter reaches before wrapping (default is the max of the type)</li>
</ul>
<h3><a class="anchor" id="autotoc_md31"></a>
✔️ Full-range timer:</h3>
<div class="fragment"><div class="line">uint32_t get_timer_count(); <span class="comment">// your hardware counter</span></div>
<div class="line"><span class="keyword">using </span>MyClock = <a class="code hl_struct" href="../../da/d86/structembed_1_1_clock.html">embed::Clock&lt;uint32_t, std::micro, get_timer_count&gt;</a>;</div>
<div class="ttc" id="astructembed_1_1_clock_html"><div class="ttname"><a href="../../da/d86/structembed_1_1_clock.html">embed::Clock</a></div><div class="ttdoc">A template for an overflow aware clock type for the use with TimePoint</div><div class="ttdef"><b>Definition</b> Clock.hpp:413</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md32"></a>
✔️ Timer that wraps at a custom maximum (e.g., 1023):</h3>
<div class="fragment"><div class="line"><span class="keyword">using </span>MyClock = <a class="code hl_struct" href="../../da/d86/structembed_1_1_clock.html">embed::Clock</a>&lt;uint32_t, std::micro, get_timer_count, 1024-1&gt;;</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>⚠️ The fourth template argument is the <b>maximum value the counter counts to</b>, <em>not</em> the value <em>after</em> overflow. </p>
</blockquote>
<p>Once defined, you can use this clock directly: </p><div class="fragment"><div class="line">MyClock::time_point start = MyClock::now();</div>
<div class="line">...</div>
<div class="line">MyClock::time_point now = MyClock::now();</div>
<div class="line"><a class="code hl_typedef" href="../../da/d2e/namespaceembed.html#a0223e2bd607a0788b0c7955a65dfe73f">embed::Duration&lt;uint32_t, std::micro&gt;</a> elapsed = now - start;</div>
<div class="line">...</div>
<div class="line">embed::RealTimeScheduler&lt;MyClock&gt; rtscheduler;</div>
<div class="line">rtscheduler.addTask(task);</div>
<div class="ttc" id="anamespaceembed_html_a0223e2bd607a0788b0c7955a65dfe73f"><div class="ttname"><a href="../../da/d2e/namespaceembed.html#a0223e2bd607a0788b0c7955a65dfe73f">embed::Duration</a></div><div class="ttdeci">std::chrono::duration&lt; ClockTick&lt; UInt, MaxTick &gt;, Period &gt; Duration</div><div class="ttdoc">Overflow aware time duration type.</div><div class="ttdef"><b>Definition</b> Clock.hpp:330</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="benefits"></a>
Why Use This?</h1>
<ul>
<li>Fully portable overflow handling — just like hardware timers</li>
<li>Clean, standard-compliant chrono API</li>
<li>Backed by real unit tests with corner-case handling (<code>Clock_test.cpp</code>)</li>
<li>Integrates easily into <code>embedOS</code> or any cooperative scheduler</li>
<li>Avoids common embedded bugs with counter wraparound and time comparison</li>
</ul>
<hr  />
<h1><a class="anchor" id="test"></a>
Testing</h1>
<p>The implementation is heavily unit tested:</p><ul>
<li>Construction, addition, subtraction of <code>ClockTick</code></li>
<li>Comparison logic across overflow windows</li>
<li>Integration with standard chrono literals</li>
<li>Realistic use cases using custom <code>Clock</code> types</li>
</ul>
<p>See <code>Clock_test.cpp</code> for examples.</p>
<hr  />
<h1><a class="anchor" id="summary"></a>
Summary</h1>
<p><code>embed</code> makes working with microcontroller timers as safe and intuitive as modern C++ chrono types — without giving up performance or hardware alignment. You keep full control over the tick source, overflow range, and resolution, and the library guarantees that comparisons and arithmetic Just Work™.</p>
<dl class="section see"><dt>See also</dt><dd>ClockTick, TimePoint, Duration, Clock, CClock </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
